<div class="main-content">
  @if (candidate) {
  <div class="candidate-card">
    <div class="candidate-info">
      <div class="candidate-details">
        <h1 class="candidate-name">{{ candidate.fullName }}</h1>
        <p class="candidate-position">{{ candidate.position }}</p>

        <div class="contact-info">
          <div class="contact-item">
            <label>Email</label>
            <a href="mailto:{{ candidate.email }}">{{ candidate.email }}</a>
          </div>
          <div class="contact-item">
            <label>Phone</label>
            <a href="tel:{{ candidate.phone }}">+ {{ candidate.phone }}</a>
          </div>
          <div class="contact-item">
            <label>Address</label>
            <span>{{ candidate.address }}</span>
          </div>
        </div>
      </div>

      <div class="candidate-actions">
        <button class="btn-primary small" (click)="viewCV()">View CV</button>
        @if (candidateFeedbacks.length > 0) {
        <button class="btn-primary small" (click)="openViewFeedbackDialog()">
          View Feedback
        </button>
        }
      </div>
    </div>
  </div>
  }

  <div class="interview-progress">
    @if (processTitle) {
    <h2 class="section-title">{{ processTitle }}</h2>
    } @else {
    <h2 class="section-title">Interview Progress</h2>
    }

    <div class="interview-stages">
      @for (stage of interviewStages; track stage.stageId) {
      <div
        class="interview-stage"
        [ngClass]="{
          rejected: stage?.status === 'REJECTED',
          pending: stage?.status === 'NOT_STARTED',
          completed: stage?.status === 'COMPLETED',
          in_progress: stage?.status === 'IN_PROGRESS'
        }"
      >
        <div class="stage-icon">
          @if (getStageIcon(stage.title) === 'phone') {
          <span>ðŸ“ž</span>
          } @else if (getStageIcon(stage.title) === 'document') {
          <span>ðŸ“„</span>
          } @else if (getStageIcon(stage.title) === 'monitor') {
          <span>ðŸ’»</span>
          } @else if (getStageIcon(stage.title) === 'business-bag') {
          <span>ðŸ’¼</span>
          }
        </div>

        <div class="stage-content">
          <div class="stage-details">
            <span class="stage-name">{{ stage.title }}</span>
            <span class="interviewer-list">
              {{ stage.interviewer?.fullName }}
            </span>
          </div>
          <span class="stage-status-message">
            {{ formatStatus(stage.status) }}
          </span>
        </div>

        @if (stage?.status === 'IN_PROGRESS') {
        <div class="stage-actions">
          <button
            class="btn-primary small"
            (click)="
              openAddFeedbackDialog(
                stage.stageId,
                stage.interviewer?.interviewerId
              )
            "
          >
            Add Feedback
          </button>
        </div>
        }
      </div>
      }
    </div>
  </div>
</div>

@if (showAddFeedbackDialog) {
<app-add-feedback
  [candidateId]="candidate?.candidateId!"
  [stageId]="selectedStageId"
  [interviewerId]="selectedInterviewerId"
  (closeDialog)="onAddDialogClose()"
></app-add-feedback>
} @if (showViewFeedbackDialog) {
<app-view-feedback
  [candidateId]="candidate?.candidateId!"
  (closeDialog)="onViewDialogClose()"
></app-view-feedback>
}
