<div class="main-content">
  @if (process$ | async; as process) {
  <div class="process-card">
    <div class="process-info">
      <div class="process-details">
        <h1 class="process-name">{{ process.title }}</h1>
        <p class="process-status">{{ process.status }}</p>

        <div class="meta-info">
          <div class="meta-item">
            <label>Created By</label>
            <span>{{ process.createdBy }}</span>
          </div>
          <div class="meta-item">
            <label>Created On</label>
            <span>{{ process.createdDate }}</span>
          </div>
        </div>
      </div>

      <div class="process-actions">
        <button
          class="btn-primary small"
          (click)="addStage()"
          [disabled]="process.status === 'COMPLETED'"
        >
          Add Stage
        </button>
        <button
          class="btn-primary small"
          (click)="addCandidateToProcess()"
          [disabled]="process.status === 'COMPLETED'"
        >
          Add Candidate
        </button>
        <button
          class="btn-primary small"
          (click)="endProcess()"
          [disabled]="process.status === 'COMPLETED'"
        >
          End Process
        </button>
      </div>
    </div>
  </div>

  <div class="interview-progress">
    <div class="tabs-container">
      <button
        class="tab-btn"
        [ngClass]="{ active: activeTab === 'stages' }"
        (click)="selectTab('stages')"
      >
        Interview Stages
      </button>
      <button
        class="tab-btn"
        [ngClass]="{ active: activeTab === 'candidates' }"
        (click)="selectTab('candidates')"
      >
        Candidates
      </button>
    </div>

    <div class="tab-content" [hidden]="activeTab !== 'stages'">
      <div class="interview-stages">
        @for (stage of processStages; track stage.stageId) {
        <div
          class="interview-stage"
          [ngClass]="{
            completed: stage.status === 'COMPLETED',
            pending: stage.status === 'NOT_STARTED',
            in_progress: stage.status === 'IN_PROGRESS'
          }"
        >
          <div class="stage-icon">
            @if (stage.icon === 'phone') {
            <span>ðŸ“ž</span>
            } @else if (stage.icon === 'monitor') {
            <span>ðŸ’»</span>
            } @else if (stage.icon === 'business-bag') {
            <span>ðŸ’¼</span>
            } @else {
            <span>ðŸ“„</span>
            }
          </div>

          <div class="stage-content">
            <div class="stage-details">
              <span class="stage-name">{{ stage.title }}</span>
              @if (stage.assignedInterviewers &&
              stage.assignedInterviewers.length > 0) {
              <div class="interviewer-list">
                Assigned to:
                <span>
                  {{ getAssignedInterviewerNames(stage.assignedInterviewers) }}
                </span>
              </div>
              }
            </div>
            <span class="stage-status-message">{{
              formatStatus(stage.status)
            }}</span>
          </div>

          @if (stage.status === 'IN_PROGRESS') {
          <div class="stage-actions">
            <div class="tooltip-container">
              <span
                class="next-stage-arrow"
                (click)="moveToNextStage(stage.stageId)"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-arrow-right"
                >
                  <path d="M5 12h14" />
                  <path d="m12 5 7 7-7 7" />
                </svg>
              </span>
              <span class="tooltip-text">Move to next stage</span>
            </div>
          </div>
          }
        </div>
        }
      </div>
      @if (process?.status === 'COMPLETED') {
      <div class="process-ended-message">This process has ended.</div>
      }
    </div>

    <div class="tab-content" [hidden]="activeTab !== 'candidates'">
      <div class="candidates-grid">
        @for (candidate of processCandidates; track candidate.candidateId) {
        <div
          class="candidate-card"
          (click)="viewCandidateProfile(candidate.candidateId)"
        >
          <div class="card-header">
            <h4>{{ candidate.fullName }}</h4>
            <p>{{ candidate.position }}</p>
          </div>
          <div class="card-body">
            <p><strong>Status:</strong> {{ candidate.status }}</p>
          </div>
        </div>
        } @if (processCandidates.length === 0) {
        <p class="empty-list-message">
          No candidates have been added to this process yet.
        </p>
        }
      </div>
    </div>
  </div>
  } @else {
  <div class="loading-container">
    <p>Loading process details...</p>
  </div>
  } @if (showAddStageDialog) {
  <app-add-stage
    [processId]="currentProcessId"
    (closeDialog)="closeAddStageDialog()"
    (stageCreated)="onStageCreated($event)"
  ></app-add-stage>
  } @if (showAddCandidateDialog) {
  <app-add-candidate-to-process
    [processId]="currentProcessId"
    [candidates]="candidates"
    (closeDialog)="closeAddCandidateDialog()"
    (candidateAssigned)="onCandidateAssigned()"
  ></app-add-candidate-to-process>
  }
</div>
